<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVerve</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Global variables
        let userId = null;
        let userBalance = 0;

        // Function to generate a unique user ID
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        }

        // Function to copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('success', 'User ID copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Function to show/hide login screen
        function toggleLoginScreen(show) {
            document.getElementById('loginScreen').classList.toggle('hidden', !show);
            document.getElementById('mainApp').classList.toggle('hidden', show);
            if (!show) {
                // After showing the main app, attach event listeners
                attachEventListeners();
            }
        }

        // Function to attach event listeners to buttons
        function attachEventListeners() {
            // Attach event listener for Merge PDFs button
            const mergePdfBtn = document.getElementById('mergePdfBtn');
            if (mergePdfBtn) {
                mergePdfBtn.addEventListener('click', mergePdfs);
            }

            // Attach event listener for Download Merged PDF button
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            if (downloadPdfBtn) {
                downloadPdfBtn.addEventListener('click', downloadMergedPdf);
            }

            // Attach event listener for Generate Application Letter button
            const generateLetterBtn = document.getElementById('generateLetterBtn');
            if (generateLetterBtn) {
                generateLetterBtn.addEventListener('click', generateLetter);
            }

            // Attach event listener for Download Letter button
            const downloadLetterBtn = document.getElementById('downloadLetterBtn');
            if (downloadLetterBtn) {
                downloadLetterBtn.addEventListener('click', downloadLetterAsPdf);
            }

            // Attach event listener for Confirm Payment button
            const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
            if (confirmPaymentBtn) {
                confirmPaymentBtn.addEventListener('click', confirmPayment);
            }
        }

        // Function to handle user login
        async function handleLogin() {
            const inputUserId = document.getElementById('userIdInput').value.trim();
            
            if (!inputUserId) {
                showMessage('error', 'Please enter your User ID');
                return;
            }

            try {
                // Check if user exists in database
                const response = await fetch('/.netlify/functions/get-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: inputUserId }),
                });

                const data = await response.json();

                if (response.ok) {
                    userId = inputUserId;
                    userBalance = data.balance;
                    
                    // Update UI
                    document.getElementById('userIdDisplay').textContent = "User ID: " + userId;
                    document.getElementById('balanceDisplay').textContent = userBalance.toFixed(2);
                    document.getElementById('dashboardUserId').textContent = userId;
                    
                    toggleLoginScreen(false);
                    showMessage('success', 'Login successful!');
                } else {
                    showMessage('error', data.error || 'User not found');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('error', 'Login failed. Please try again.');
            }
        }

        // Function to generate new user ID
        async function generateNewUserId() {
            const newUserId = generateUserId();
            
            // Show generated ID to user
            document.getElementById('generatedUserId').textContent = newUserId;
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('newUserIdSection').classList.remove('hidden');
            
            // Animate the copy button
            const copyBtn = document.getElementById('copyUserIdBtn');
            copyBtn.classList.add('animate-pulse');
            
            // Store the generated ID for later use
            window.generatedUserId = newUserId;
        }

        // Function to copy generated user ID
        function copyGeneratedUserId() {
            copyToClipboard(window.generatedUserId);
            
            // Stop the animation after copying
            document.getElementById('copyUserIdBtn').classList.remove('animate-pulse');
        }

        // Function to show save confirmation
        function showSaveConfirmation() {
            document.getElementById('saveConfirmation').classList.remove('hidden');
        }

        // Function to handle save confirmation response
        async function handleSaveConfirmation(saved) {
            document.getElementById('saveConfirmation').classList.add('hidden');
            
            if (saved) {
                try {
                    // Create new user in database
                    const response = await fetch('/.netlify/functions/create-user', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            userId: window.generatedUserId,
                            balance: 0 
                        }),
                    });

                    if (response.ok) {
                        userId = window.generatedUserId;
                        userBalance = 0;
                        
                        // Update UI
                        document.getElementById('userIdDisplay').textContent = "User ID: " + userId;
                        document.getElementById('balanceDisplay').textContent = '0.00';
                        document.getElementById('dashboardUserId').textContent = userId;
                        
                        toggleLoginScreen(false);
                        showMessage('success', 'Account created successfully!');
                    } else {
                        const data = await response.json();
                        showMessage('error', data.error || 'Failed to create account');
                    }
                } catch (error) {
                    console.error('Account creation error:', error);
                    showMessage('error', 'Account creation failed. Please try again.');
                }
            } else {
                // If user didn't save, show the ID again
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('newUserIdSection').classList.add('hidden');
                showMessage('warning', 'Please save your User ID to continue');
            }
        }

        // Show message function
        function showMessage(type, message) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageBox.className = `fixed inset-x-0 bottom-4 mx-auto p-4 rounded-lg shadow-lg z-50 max-w-sm ${type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-yellow-500'} text-white text-center font-bold transition-all duration-300 transform scale-0`;
            messageText.textContent = message;
            setTimeout(() => {
                messageBox.classList.add('scale-100');
            }, 10);
            setTimeout(() => {
                messageBox.classList.remove('scale-100');
            }, 3000);
        }

        // Show popup function for image-based PDFs
        function showImageBasedPdfPopup() {
            const popup = document.getElementById('imageBasedPdfPopup');
            popup.classList.remove('hidden');
        }

        // Close popup function
        function closeImageBasedPdfPopup() {
            const popup = document.getElementById('imageBasedPdfPopup');
            popup.classList.add('hidden');
        }

        // Initialize the app
        window.onload = function() {
            toggleLoginScreen(true);
        };

        // --- Tab Switching Logic ---
        window.switchTab = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-b-2', 'border-indigo-500');
            });
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-button`).classList.add('border-b-2', 'border-indigo-500');
        };

        // --- PDF Merger Logic ---
        let mergedPdf = null;

        async function mergePdfs() {
            const files = document.getElementById('pdfInput').files;
            if (files.length < 2) {
                showMessage('error', 'Please select at least two PDF files to merge.');
                return;
            }

            const cost = 0.95;

            if (userBalance < cost) {
                showMessage('error', `Not enough balance. Please top up your account. Cost: ${cost} ETB`);
                return;
            }

            try {
                const { PDFDocument } = window.PDFLib;
                const mergedDoc = await PDFDocument.create();

                for (const file of files) {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    const copiedPages = await mergedDoc.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    copiedPages.forEach(page => mergedDoc.addPage(page));
                }

                mergedPdf = await mergedDoc.save();
                document.getElementById('downloadPdfBtn').classList.remove('hidden');
                showMessage('success', 'PDFs merged successfully!');
                
                // Update balance
                await updateBalance(-cost);
            } catch (error) {
                console.error('Error merging PDFs:', error);
                showMessage('error', 'Failed to merge PDFs. Please try again.');
            }
        }

        function downloadMergedPdf() {
            if (mergedPdf) {
                const blob = new Blob([mergedPdf], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'merged_document.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // --- Application Letter Logic ---
        async function generateLetter() {
    const fullName = document.getElementById('fullName').value;
    const phone = document.getElementById('phone').value;
    const email = document.getElementById('email').value;
    const address = document.getElementById('address').value;
    const appDate = document.getElementById('appDate').value;
    const cvFiles = document.getElementById('cvFile').files;
    const jdFiles = document.getElementById('jdFile').files;

    if (!fullName || !phone || !email || !address || !appDate || cvFiles.length === 0 || jdFiles.length === 0) {
        showMessage('error', 'Please fill all fields and upload at least one file for both CV and Job Description.');
        return;
    }

    const cost = 1.95;

    if (userBalance < cost) {
        showMessage('error', `Not enough balance. Please top up your account. Cost: ${cost} ETB`);
        return;
    }

    document.getElementById('loadingIndicator').classList.remove('hidden');

    try {
        // Process CV files to base64
        const cvFilesData = [];
        for (let i = 0; i < cvFiles.length; i++) {
            const file = cvFiles[i];
            const base64Data = await fileToBase64(file);
            cvFilesData.push({
                data: base64Data,
                type: file.type
            });
        }

        // Process JD files to base64
        const jdFilesData = [];
        for (let i = 0; i < jdFiles.length; i++) {
            const file = jdFiles[i];
            const base64Data = await fileToBase64(file);
            jdFilesData.push({
                data: base64Data,
                type: file.type
            });
        }

        console.log("Extracting text from CV files...");
        // Step 1: Extract text from CV files
        const cvExtractionResponse = await fetch('/.netlify/functions/extract-text', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                files: cvFilesData,
                fileType: 'cv'
            })
        });

        if (!cvExtractionResponse.ok) {
            const errorData = await cvExtractionResponse.json();
            
            // Check if it's an image-based PDF error
            if (errorData.error && errorData.error.includes('image-based')) {
                showImageBasedPdfPopup();
                document.getElementById('loadingIndicator').classList.add('hidden');
                return;
            }
            
            throw new Error(`CV extraction failed: ${errorData.error}`);
        }

        const cvExtractionResult = await cvExtractionResponse.json();
        const cvText = cvExtractionResult.extractedText;

        console.log("Extracting text from JD files...");
        // Step 2: Extract text from JD files
        const jdExtractionResponse = await fetch('/.netlify/functions/extract-text', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                files: jdFilesData,
                fileType: 'jd'
            })
        });

        if (!jdExtractionResponse.ok) {
            const errorData = await jdExtractionResponse.json();
            
            // Check if it's an image-based PDF error
            if (errorData.error && errorData.error.includes('image-based')) {
                showImageBasedPdfPopup();
                document.getElementById('loadingIndicator').classList.add('hidden');
                return;
            }
            
            throw new Error(`JD extraction failed: ${errorData.error}`);
        }

        const jdExtractionResult = await jdExtractionResponse.json();
        const jdText = jdExtractionResult.extractedText;

        console.log("Generating letter with AI...");
        // Step 3: Generate letter with extracted text
        const letterResponse = await fetch('/.netlify/functions/generate-letter', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                fullName: fullName,
                phone: phone,
                email: email,
                address: address,
                appDate: appDate,
                cvText: cvText,
                jdText: jdText
            })
        });

        if (!letterResponse.ok) {
            const errorData = await letterResponse.json();
            throw new Error(`Letter generation failed: ${errorData.error}`);
        }

        const result = await letterResponse.json();
        const letterText = result.letterText;

        if (letterText) {
            document.getElementById('applicationLetter').value = letterText;
            document.getElementById('downloadLetterBtn').classList.remove('hidden');
            showMessage('success', 'Application letter generated successfully!');
            
            // Update balance
            await updateBalance(-cost);
        } else {
            showMessage('error', 'Could not generate letter. Please try again.');
        }

    } catch (error) {
        console.error('Error generating letter:', error);
        showMessage('error', error.message || 'An unexpected error occurred.');
    } finally {
        document.getElementById('loadingIndicator').classList.add('hidden');
    }
}

        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }
        
        function downloadLetterAsPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const letterContent = document.getElementById('applicationLetter').value;
            
            // Set font and size
            doc.setFont('Times-Roman');
            doc.setFontSize(12);
            
            // Calculate the maximum width for text (page width minus margins)
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 15; // Reduced margins to use more horizontal space
            const maxWidth = pageWidth - (margin * 2);
            
            // Split the text into lines that fit within the maxWidth
            const lines = doc.splitTextToSize(letterContent, maxWidth);
            
            // Start position for text
            let y = 20;
            
            // Add each line to the PDF
            for (let i = 0; i < lines.length; i++) {
                // Add text line with full width
                doc.text(lines[i], margin, y);
                
                // Move to next line
                y += 7;
            }
            
            // Save the PDF
            doc.save('application_letter.pdf');
        };

        // --- Payment Logic ---
        window.showTopUpForm = () => {
            document.getElementById('topUpForm').classList.remove('hidden');
        };

        async function confirmPayment() {
            const screenshotFile = document.getElementById('paymentScreenshot').files[0];
            if (!screenshotFile) {
                showMessage('error', 'Please upload a screenshot.');
                return;
            }

            document.getElementById('loadingIndicatorPayment').classList.remove('hidden');

            try {
                const screenshotData = await fileToBase64(screenshotFile);

                const response = await fetch('/.netlify/functions/process-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: userId,
                        screenshotData: screenshotData,
                        screenshotType: screenshotFile.type
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Payment Error:', errorData);
                    showMessage('error', `Payment Error: ${response.statusText}`);
                    document.getElementById('loadingIndicatorPayment').classList.add('hidden');
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.newBalance;
                    document.getElementById('balanceDisplay').textContent = userBalance.toFixed(2);
                    showMessage('success', 'Payment confirmed! Your balance has been updated.');
                    document.getElementById('topUpForm').classList.add('hidden');
                } else {
                    showMessage('error', result.message || 'Payment failed');
                }

            } catch (error) {
                console.error('Error confirming payment:', error);
                showMessage('error', 'An unexpected error occurred during payment confirmation.');
            } finally {
                document.getElementById('loadingIndicatorPayment').classList.add('hidden');
            }
        }

        // Function to update user balance
        async function updateBalance(amount) {
            try {
                const response = await fetch('/.netlify/functions/update-balance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        userId: userId,
                        amount: amount
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    userBalance = data.balance;
                    document.getElementById('balanceDisplay').textContent = userBalance.toFixed(2);
                    return true;
                } else {
                    console.error('Balance update error:', data.error);
                    return false;
                }
            } catch (error) {
                console.error('Balance update error:', error);
                return false;
            }
        }
    </script>
    <style>
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-[Inter]">

    <!-- Message Box -->
    <div id="messageBox" class="hidden">
        <p id="messageText"></p>
    </div>

    <!-- Image-based PDF Popup -->
    <div id="imageBasedPdfPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-lg max-w-md w-full mx-4">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Image-based PDF Detected</h3>
                <p class="text-sm text-gray-600 mb-4">
                    Your CV PDF is image-based and cannot be extracted. Please upload screenshots of your CV instead.
                </p>
                <p class="text-xs text-gray-500 mb-4">
                    Tip: Take screenshots of each page of your CV and upload them as images (JPG or PNG).
                </p>
                <button onclick="closeImageBasedPdfPopup()" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-indigo-600 transition-colors">
                    OK, I Understand
                </button>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gray-100 flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-lg max-w-md w-full">
            <h1 class="text-3xl font-bold text-center text-indigo-600 mb-2">CVerve</h1>
            <p class="text-sm text-center text-gray-500 mb-6">Login to access your account</p>
            
            <div id="loginForm">
                <div class="mb-4">
                    <label for="userIdInput" class="block text-sm font-medium text-gray-700 mb-1">Your User ID</label>
                    <input type="text" id="userIdInput" placeholder="Enter your User ID" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                
                <button onclick="handleLogin()" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-indigo-600 transition-colors duration-200 shadow-md mb-4">
                    Login
                </button>
                
                <div class="text-center">
                    <p class="text-sm text-gray-600">Don't have a User ID?</p>
                    <button onclick="generateNewUserId()" class="text-indigo-600 font-semibold text-sm hover:underline mt-1">
                        Generate New User ID
                    </button>
                </div>
            </div>
            
            <div id="newUserIdSection" class="hidden">
                <div class="bg-yellow-50 p-4 rounded-lg text-sm text-yellow-800 mb-4">
                    <h3 class="font-bold mb-2">Important!</h3>
                    <p>Please save this User ID in a secure place. You will need it to access your account in the future.</p>
                </div>
                
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg mb-4">
                    <span id="generatedUserId" class="font-mono text-sm"></span>
                    <button id="copyUserIdBtn" onclick="copyGeneratedUserId()" class="bg-indigo-100 text-indigo-700 p-2 rounded-full hover:bg-indigo-200 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                    </button>
                </div>
                
                <button onclick="showSaveConfirmation()" class="w-full bg-emerald-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-emerald-600 transition-colors duration-200 shadow-md">
                    Continue
                </button>
            </div>
            
            <div id="saveConfirmation" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full mx-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Have you saved your User ID in a safe place?</h3>
                    <p class="text-sm text-gray-600 mb-6">You won't be able to recover your account if you lose this ID.</p>
                    <div class="flex space-x-4">
                        <button onclick="handleSaveConfirmation(false)" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-red-600 transition-colors">
                            No
                        </button>
                        <button onclick="handleSaveConfirmation(true)" class="flex-1 bg-emerald-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-emerald-600 transition-colors">
                            Yes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="container mx-auto p-4 max-w-lg mt-8 rounded-xl shadow-lg bg-white">
            
            <!-- Header with User ID -->
            <div class="flex items-center justify-between mb-2">
                <h1 class="text-3xl font-bold text-indigo-600">CVerve</h1>
                <div class="flex items-center">
                    <span class="text-sm text-gray-500 mr-2" id="dashboardUserId"></span>
                    <button onclick="copyToClipboard(userId)" class="text-indigo-600 hover:text-indigo-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <p class="text-sm text-center text-gray-500 mb-6" id="userIdDisplay">User ID: Loading...</p>
            
            <!-- Tab Navigation -->
            <div class="flex border-b border-gray-200 mb-4">
                <button id="merger-button" onclick="switchTab('merger')" class="tab-button w-1/3 py-2 text-center text-sm font-semibold text-gray-600 border-b-2 border-indigo-500">PDF Merger</button>
                <button id="letter-button" onclick="switchTab('letter')" class="tab-button w-1/3 py-2 text-center text-sm font-semibold text-gray-600">Application Letter</button>
                <button id="payment-button" onclick="switchTab('payment')" class="tab-button w-1/3 py-2 text-center text-sm font-semibold text-gray-600">Payment</button>
            </div>

            <!-- Tab Content Containers -->
            <div id="merger-content" class="tab-content">
                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h2 class="text-xl font-semibold mb-4 text-center">PDF Merger</h2>
                    <div class="space-y-4">
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Upload PDFs in order:</span>
                            <input type="file" id="pdfInput" multiple accept="application/pdf" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition duration-150">
                        </label>
                        <button id="mergePdfBtn" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-indigo-600 transition-colors duration-200 shadow-md">Merge PDFs</button>
                        <button id="downloadPdfBtn" class="w-full bg-emerald-500 text-white py-2 px-4 rounded-full font-semibold hidden hover:bg-emerald-600 transition-colors duration-200 shadow-md">Download Merged PDF</button>
                    </div>
                </div>
            </div>

            <div id="letter-content" class="tab-content hidden">
                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h2 class="text-xl font-semibold mb-4 text-center">Application Letter Writer</h2>
                    <div class="space-y-4">
                        <input type="text" id="fullName" placeholder="Full Name" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <input type="tel" id="phone" placeholder="Phone Number" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <input type="email" id="email" placeholder="Email" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <input type="text" id="address" placeholder="Address" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <input type="date" id="appDate" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Upload Your CV Files (Image, PDF, Word)</span>
                            <input type="file" id="cvFile" multiple accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition duration-150">
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Upload Job Description Files (Image, PDF, Word)</span>
                            <input type="file" id="jdFile" multiple accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition duration-150">
                        </label>
                        <button id="generateLetterBtn" onclick="generateLetter()" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-indigo-600 transition-colors duration-200 shadow-md">Generate Application Letter</button>
                        <div id="loadingIndicator" class="hidden text-center text-sm font-medium text-gray-500">Generating letter...</div>
                        <textarea id="applicationLetter" rows="10" placeholder="Your generated application letter will appear here..." class="w-full p-4 rounded-lg border border-gray-300 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                        <button id="downloadLetterBtn" class="w-full bg-emerald-500 text-white py-2 px-4 rounded-full font-semibold hidden hover:bg-emerald-600 transition-colors duration-200 shadow-md">Download as PDF</button>
                    </div>
                </div>
            </div>

            <div id="payment-content" class="tab-content hidden">
                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h2 class="text-xl font-semibold mb-4 text-center">Payment & Balance</h2>
                    <div class="flex items-center justify-between mb-4 bg-white p-4 rounded-lg shadow">
                        <span class="text-lg font-bold text-gray-700">Balance: <span id="balanceDisplay">0.00</span> ETB</span>
                        <button onclick="showTopUpForm()" class="bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold text-sm hover:bg-indigo-600 transition-colors duration-200 shadow-md">Top Up</button>
                    </div>
                    
                    <div id="topUpForm" class="hidden space-y-4">
                        <div class="bg-yellow-50 p-4 rounded-lg text-sm text-yellow-800">
                            <h3 class="font-bold mb-2">Payment Instructions:</h3>
                            <p>✔️ Payment Method: Bank Transfer</p>
                            <p>✔️ Bank: Commercial Bank of Ethiopia</p>
                            <p>✔️ Account Number: 1000577617639</p>
                            <p>✔️ Account Name: YILAK ABAY ABEBE</p>
                            <p>✔️ Amount: Minimum 30 ETB</p>
                            <p class="mt-2">After you pay please send the screenshot of the text you received from CBE below.</p>
                        </div>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Upload your payment screenshot</span>
                            <input type="file" id="paymentScreenshot" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition duration-150">
                        </label>
                        <button id="confirmPaymentBtn" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-indigo-600 transition-colors duration-200 shadow-md">Confirm Payment</button>
                        <div id="loadingIndicatorPayment" class="hidden text-center text-sm font-medium text-gray-500">Confirming payment...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>